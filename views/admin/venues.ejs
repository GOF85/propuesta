<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Venues - MICE Catering</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">

<%- include('../partials/header') %>

<main class="max-w-7xl mx-auto px-6 py-12">

    <%- include('../partials/flash-messages') %>

    <!-- Header Principal -->
    <div class="mb-12">
        <div class="bg-gradient-to-r from-emerald-900 to-emerald-800 rounded-lg p-8 text-white">
            <div class="flex items-start justify-between">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-4xl">üè¢</span>
                        <h1 class="text-4xl font-bold">Gesti√≥n de Venues</h1>
                    </div>
                    <p class="text-gray-200 text-lg">Importa, crea o descarga venues de tu cat√°logo maestro</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-300">Total de espacios</div>
                    <div class="text-4xl font-bold text-emerald-300"><%= totalVenues %></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- THREE MAIN ACTIONS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        
        <!-- Action 1: Manual Entry -->
        <div class="bg-white rounded-lg border-2 border-blue-200 p-8 hover:shadow-lg transition cursor-pointer" 
             onclick="switchTab('manual')">
            <div class="text-5xl mb-4">‚úèÔ∏è</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Crear Manualmente</h3>
            <p class="text-gray-600 text-sm mb-4">
                Rellena un formulario simple para agregar un venue paso a paso
            </p>
            <div class="flex items-center gap-2 text-blue-600 font-medium">
                <span>Comenzar</span>
                <span>‚Üí</span>
            </div>
        </div>
        
        <!-- Action 2: CSV Import -->
        <div class="bg-white rounded-lg border-2 border-purple-200 p-8 hover:shadow-lg transition cursor-pointer" 
             onclick="switchTab('import')">
            <div class="text-5xl mb-4">üì•</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Importar CSV</h3>
            <p class="text-gray-600 text-sm mb-4">
                Sube un archivo CSV con m√∫ltiples venues (m√°x. 50MB)
            </p>
            <div class="flex items-center gap-2 text-purple-600 font-medium">
                <span>Subir archivo</span>
                <span>‚Üí</span>
            </div>
        </div>
        
        <!-- Action 3: Scarpe & Export -->
        <div class="bg-white rounded-lg border-2 border-green-200 p-8 hover:shadow-lg transition">
            <div class="text-5xl mb-4">‚öôÔ∏è</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Gestionar</h3>
            <p class="text-gray-600 text-sm mb-4">
                Exporta tu cat√°logo, descarga template o scrapeala web
            </p>
            <div class="flex gap-2">
                <button onclick="startScraping()" class="text-sm bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded">
                    üï∑Ô∏è Scrapear
                </button>
                <a href="/admin/venues/export" class="text-sm bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">
                    ‚¨áÔ∏è Exportar
                </a>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- TAB 1: MANUAL ENTRY -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="tab-manual" class="tab-content">
        <div class="bg-white rounded-lg border border-blue-200 p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span>‚úèÔ∏è</span> Crear Venue Manualmente
            </h2>
            
            <form id="manual-form" onsubmit="submitManualForm(event)" class="space-y-6">
                <!-- Basic Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Nombre <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="name" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Ej: Hotel Palace Madrid">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Direcci√≥n
                        </label>
                        <input type="text" name="address"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Ej: Gran V√≠a 25, Madrid">
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Descripci√≥n
                    </label>
                    <textarea name="description" rows="3"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                              placeholder="Describe brevemente el venue..."></textarea>
                </div>

                <!-- Capacities -->
                <fieldset class="border border-gray-300 rounded-lg p-4">
                    <legend class="text-sm font-medium text-gray-700 px-2">Capacidades (personas)</legend>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">üç∏ C√≥ctel</label>
                            <input type="number" name="capacity_cocktail" min="0"
                                   class="w-full px-3 py-2 border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500"
                                   placeholder="0">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">üçΩÔ∏è Banquete</label>
                            <input type="number" name="capacity_banquet" min="0"
                                   class="w-full px-3 py-2 border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500"
                                   placeholder="0">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">üé≠ Teatro</label>
                            <input type="number" name="capacity_theater" min="0"
                                   class="w-full px-3 py-2 border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500"
                                   placeholder="0">
                        </div>
                    </div>
                </fieldset>

                <!-- Features -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Caracter√≠sticas <span class="text-xs text-gray-500">(separadas por coma)</span>
                    </label>
                    <input type="text" name="features"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Ej: WiFi, Parking, Aire acondicionado, Luz natural">
                </div>

                <!-- External URL -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        URL Externa
                    </label>
                    <input type="url" name="external_url"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="https://...">
                </div>

                <!-- Submit Buttons -->
                <div class="flex gap-4 justify-end pt-4 border-t border-gray-200">
                    <button type="button" onclick="resetManualForm()"
                            class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg font-medium">
                        Limpiar
                    </button>
                    <button type="submit"
                            class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium flex items-center gap-2">
                        <span>‚úÖ Guardar Venue</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- TAB 2: CSV IMPORT -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="tab-import" class="tab-content hidden">
        <div class="bg-white rounded-lg border border-purple-200 p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span>üì•</span> Importar Venues desde CSV
            </h2>
            
            <!-- Instructions -->
            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-gray-900 mb-3">üìã C√≥mo funciona:</h3>
                <ol class="space-y-2 text-sm text-gray-700 ml-4">
                    <li><span class="font-medium">1.</span> <strong>Descarga el template</strong> - bot√≥n abajo</li>
                    <li><span class="font-medium">2.</span> <strong>Rellena en Excel/Google Sheets</strong></li>
                    <li><span class="font-medium">3.</span> <strong>Sube el archivo</strong> - se importar√°n todos los venues</li>
                </ol>
                <p class="text-xs text-gray-600 mt-3">
                    ‚ÑπÔ∏è Los venues con nombre duplicado se actualizar√°n. M√°x. 50MB por archivo.
                </p>
            </div>

            <!-- Template Download -->
            <div class="mb-6">
                <a href="javascript:downloadTemplate()" 
                   class="inline-flex items-center gap-2 bg-amber-600 hover:bg-amber-700 text-white px-6 py-3 rounded-lg font-medium">
                    <span>üìÑ</span> Descargar Template CSV
                </a>
                <p class="text-xs text-gray-600 mt-2">
                    Haz click para descargar un archivo de ejemplo ya formateado
                </p>
            </div>

            <!-- Upload Area -->
            <div id="csv-upload-box" class="border-2 border-dashed border-purple-400 rounded-lg p-8 bg-purple-50 text-center hover:bg-purple-100 transition cursor-pointer"
                 ondrop="handleCsvDrop(event)" ondragover="handleCsvDragOver(event)" ondragleave="handleCsvDragLeave(event)">
                <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                
                <div class="mb-4">
                    <span class="text-5xl">üì§</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Arrastra archivo CSV aqu√≠</h3>
                <p class="text-gray-600 mb-4">o haz clic para seleccionar archivo</p>
                <p class="text-xs text-gray-500">Formatos: .csv | M√°x: 50MB</p>
            </div>

            <!-- Upload Status -->
            <div id="csv-upload-status" class="mt-6 hidden">
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Importando...</span>
                        <span id="csv-upload-progress" class="text-sm text-purple-600">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="csv-upload-bar" class="bg-purple-600 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Results -->
            <div id="csv-results" class="mt-6"></div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- VENUES LIST -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div>
        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <span>üìç</span> Cat√°logo de Venues (<%= totalVenues %>)
        </h2>

        <% if (venues.length === 0) { %>
            <div class="bg-gray-50 rounded-lg border border-gray-200 p-12 text-center">
                <p class="text-lg text-gray-500 mb-4">No hay venues a√∫n</p>
                <p class="text-sm text-gray-600 mb-6">
                    Usa "Crear Manualmente" para agregar tu primer venue<br>
                    o "Importar CSV" para cargar varios a la vez
                </p>
            </div>
        <% } else { %>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <% venues.forEach(v => { %>
                    <div class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition">
                        <h3 class="font-bold text-gray-900 mb-2"><%= v.name %></h3>
                        <p class="text-xs text-gray-600 mb-3">
                            <% if (v.address) { %>üìç <%= v.address %><% } %>
                        </p>
                        
                        <div class="flex gap-2 mb-3 flex-wrap">
                            <% if (v.capacity_cocktail) { %>
                                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">üç∏ <%= v.capacity_cocktail %></span>
                            <% } %>
                            <% if (v.capacity_banquet) { %>
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">üçΩÔ∏è <%= v.capacity_banquet %></span>
                            <% } %>
                            <% if (v.capacity_theater) { %>
                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">üé≠ <%= v.capacity_theater %></span>
                            <% } %>
                        </div>

                        <form method="POST" action="/admin/venues/<%= v.id %>/delete" style="display: inline;">
                            <button type="submit" class="text-xs text-red-600 hover:text-red-700"
                                    onclick="return confirm('¬øEliminar <%= v.name %>?')">
                                üóëÔ∏è Eliminar
                            </button>
                        </form>
                    </div>
                <% }); %>
            </div>
        <% } %>
    </div>

</main>

<%- include('../partials/footer') %>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TAB SWITCHING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Show selected tab
    const selectedTab = document.getElementById(`tab-${tabName}`);
    if (selectedTab) {
        selectedTab.classList.remove('hidden');
    }
    
    // Scroll to tab
    selectedTab?.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MANUAL FORM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function submitManualForm(event) {
    event.preventDefault();
    
    const formData = new FormData(document.getElementById('manual-form'));
    const data = Object.fromEntries(formData);
    
    // Parse features
    if (data.features) {
        data.features = data.features.split(',').map(f => f.trim()).filter(f => f);
    }
    
    try {
        const response = await fetch('/api/admin/venues/manual', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert(`‚úÖ Venue "${data.name}" creado correctamente`);
            resetManualForm();
            setTimeout(() => location.reload(), 500);
        } else {
            alert(`‚ùå Error: ${result.error || result.message}`);
        }
    } catch (err) {
        alert(`‚ùå Error: ${err.message}`);
    }
}

function resetManualForm() {
    document.getElementById('manual-form').reset();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CSV IMPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

document.addEventListener('DOMContentLoaded', () => {
    const uploadBox = document.getElementById('csv-upload-box');
    const fileInput = document.getElementById('csv-file-input');
    
    uploadBox.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', () => importCsvFile());
});

function handleCsvDragOver(event) {
    event.preventDefault();
    document.getElementById('csv-upload-box').classList.add('bg-purple-200');
}

function handleCsvDragLeave(event) {
    event.preventDefault();
    document.getElementById('csv-upload-box').classList.remove('bg-purple-200');
}

function handleCsvDrop(event) {
    event.preventDefault();
    document.getElementById('csv-upload-box').classList.remove('bg-purple-200');
    
    const files = event.dataTransfer.files;
    if (files.length > 0) {
        document.getElementById('csv-file-input').files = files;
        importCsvFile();
    }
}

async function importCsvFile() {
    const fileInput = document.getElementById('csv-file-input');
    if (!fileInput.files.length) return;
    
    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append('csvFile', file);
    
    document.getElementById('csv-upload-status').classList.remove('hidden');
    document.getElementById('csv-results').innerHTML = '';
    
    try {
        document.getElementById('csv-upload-progress').textContent = '5%';
        document.getElementById('csv-upload-bar').style.width = '5%';
        
        const response = await fetch('/admin/venues/import', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        document.getElementById('csv-upload-progress').textContent = '100%';
        document.getElementById('csv-upload-bar').style.width = '100%';
        
        // Show results
        let resultsHtml = '<div class="grid grid-cols-3 gap-4 mt-4">';
        resultsHtml += `<div class="bg-green-50 border border-green-200 rounded p-3 text-center">`;
        resultsHtml += `<div class="text-2xl font-bold text-green-600">${result.inserted || 0}</div>`;
        resultsHtml += `<div class="text-xs text-green-700">Nuevos importados</div>`;
        resultsHtml += `</div>`;
        
        resultsHtml += `<div class="bg-blue-50 border border-blue-200 rounded p-3 text-center">`;
        resultsHtml += `<div class="text-2xl font-bold text-blue-600">${result.updated || 0}</div>`;
        resultsHtml += `<div class="text-xs text-blue-700">Actualizados</div>`;
        resultsHtml += `</div>`;
        
        resultsHtml += `<div class="bg-amber-50 border border-amber-200 rounded p-3 text-center">`;
        resultsHtml += `<div class="text-2xl font-bold text-amber-600">${result.total || 0}</div>`;
        resultsHtml += `<div class="text-xs text-amber-700">Total procesados</div>`;
        resultsHtml += `</div>`;
        resultsHtml += `</div>`;
        
        if (result.errors && result.errors.length > 0) {
            resultsHtml += '<div class="mt-4 bg-red-50 border border-red-200 rounded p-3">';
            resultsHtml += '<p class="text-sm font-medium text-red-700 mb-2">‚ö†Ô∏è Errores:</p>';
            resultsHtml += '<ul class="text-xs text-red-600">';
            result.errors.forEach(err => {
                resultsHtml += `<li>‚Ä¢ ${err}</li>`;
            });
            resultsHtml += '</ul></div>';
        }
        
        resultsHtml += '<div class="mt-6"><button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">Recargar e ver cambios</button></div>';
        
        document.getElementById('csv-results').innerHTML = resultsHtml;
        
        setTimeout(() => {
            document.getElementById('csv-upload-status').classList.add('hidden');
        }, 2000);
        
    } catch (err) {
        document.getElementById('csv-results').innerHTML = `<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">‚ùå Error: ${err.message}</div>`;
    }
}

function downloadTemplate() {
    const csv = `name,description,address,capacity_cocktail,capacity_banquet,capacity_theater,features,external_url
Hotel Palace,Sal√≥n elegante con vista al parque,Gran V√≠a 25 Madrid,200,150,300,Wifi;Parking;Luz natural,https://hotelpalace.es
Sal√≥n Ballroom,Espacio moderno y completamente flexible,Plaza Mayor 10 Madrid,300,250,400,AC;WiFi;Catering,https://example.com
Centro Congresos,Gran capacidad para eventos corporativos,Paseo de la Castellana 50,500,400,600,Wifi;Parking;Ascensores,https://example.com`;
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'venues-template.csv';
    a.click();
}

async function startScraping() {
    if (!confirm('¬øEjecutar scraping de micecatering.com? Esto puede tomar unos minutos...')) {
        return;
    }
    alert('‚ÑπÔ∏è Scraping iniciado. La interfaz se cerrar√° cuando complete.');
    // Implementation would fetch /api/admin/venues/scrape
}

console.log('‚úÖ Venues admin script loaded');
</script>

</body>
</html>
    <div id="tab-list" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <div>
                <p class="text-gray-600">Total: <strong><%= totalVenues %> venues</strong></p>
            </div>
            <a href="/admin/venues/export" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">
                ‚¨áÔ∏è Exportar CSV
            </a>
        </div>

        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <% if (venues.length === 0) { %>
                <div class="p-12 text-center text-gray-500">
                    <p class="mb-4">No hay venues. Importa algunos desde la pesta√±a "Importar JSON".</p>
                </div>
            <% } else { %>
                <table class="w-full text-sm">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left font-semibold text-gray-700">Nombre</th>
                            <th class="px-6 py-3 text-left font-semibold text-gray-700">Direcci√≥n</th>
                            <th class="px-6 py-3 text-center font-semibold text-gray-700">Cocktail</th>
                            <th class="px-6 py-3 text-center font-semibold text-gray-700">Banquete</th>
                            <th class="px-6 py-3 text-left font-semibold text-gray-700">Features</th>
                            <th class="px-6 py-3 text-center font-semibold text-gray-700">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <% venues.forEach(venue => { %>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4">
                                <div class="font-medium text-gray-900"><%= venue.name %></div>
                                <div class="text-xs text-gray-500"><%= venue.description ? venue.description.substring(0, 50) + '...' : '' %></div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-600"><%= venue.address %></td>
                            <td class="px-6 py-4 text-center text-sm">
                                <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded"><%= venue.capacity_cocktail %></span>
                            </td>
                            <td class="px-6 py-4 text-center text-sm">
                                <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded"><%= venue.capacity_banquet %></span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <% 
                                  const features = typeof venue.features === 'string' ? JSON.parse(venue.features) : venue.features;
                                  const featureList = Array.isArray(features) ? features.slice(0, 2).join(', ') : '';
                                %>
                                <%= featureList %><%= featureList.length > 30 ? '...' : '' %>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <form method="POST" action="/admin/venues/<%= venue.id %>/delete" style="display: inline;">
                                    <button type="submit" class="text-red-600 hover:text-red-700 font-medium text-sm"
                                            onclick="return confirm('¬øEliminar <%= venue.name %>?')">
                                        üóëÔ∏è Eliminar
                                    </button>
                                </form>
                            </td>
                        </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } %>
        </div>
    </div>

    <!-- TAB 2: IMPORTAR CSV -->
    <div id="tab-import" class="tab-content hidden">
        <div class="bg-white rounded-lg border border-gray-200 p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Importar Venues desde CSV</h2>
            
            <form id="import-form" method="POST" action="/admin/venues/import" enctype="multipart/form-data">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÅ Archivo CSV</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 cursor-pointer transition"
                         id="dropzone" onclick="document.getElementById('csvFile').click()">
                        <input type="file" id="csvFile" name="csvFile" accept=".csv" class="hidden" required>
                        <p class="text-gray-600 font-medium">Arrastra un CSV aqu√≠ o haz clic para seleccionar</p>
                        <p class="text-sm text-gray-500 mt-1">Formato: CSV con encabezados</p>
                        <p id="file-name" class="text-blue-600 font-medium mt-2"></p>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                        ‚úÖ Importar
                    </button>
                </div>

                <div id="import-result" class="mt-6 hidden"></div>
            </form>
        </div>
    </div>

    <!-- TAB 3: PLANTILLA -->
    <div id="tab-template" class="tab-content hidden">
        <div class="bg-white rounded-lg border border-gray-200 p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üì• Descargar Plantilla CSV de Venues</h2>
            <p class="text-gray-600 mb-4">Descarga este archivo CSV, ed√≠talo en Excel o Google Sheets, y luego imp√≥rtalo:</p>

            <pre class="bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-x-auto text-sm"><code id="template-code">name,description,capacity_cocktail,capacity_banquet,capacity_theater,features,address,map_iframe,external_url,images
"Sala Modernista Barcelona","Espacio di√°fano con techos altos",200,120,150,"Luz natural|Wifi|Proyector 4K","Passeig de Gr√†cia, 85, Barcelona","https://maps.google.com/?q=Barcelona","https://ejemplo.com/barcelona","/uploads/venues/barcelona-1.webp"
"Hotel Boutique Madrid","Terraza panor√°mica con vistas",150,80,100,"Vista panor√°mica|Wifi|Toldo retr√°ctil","Gran V√≠a, 32, Madrid","https://maps.google.com/?q=Madrid","https://ejemplo.com/madrid","/uploads/venues/madrid-1.webp"</code></pre>

            <div class="flex gap-3 mt-6">
                <button id="copy-template" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                    üìã Copiar Plantilla
                </button>
                <a id="download-template" href="#" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium inline-block">
                    ‚¨áÔ∏è Descargar CSV
                </a>
            </div>

            <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-900">
                    <strong>üìù Columnas:</strong> name (requerido), description, capacity_cocktail, capacity_banquet, capacity_theater, features (separadas por |), address, map_iframe, external_url, images
                </p>
            </div>
        </div>
    </div>

</main>

<%- include('../partials/footer') %>

<script>
function showTab(tab) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
    document.getElementById(`tab-${tab}`).classList.remove('hidden');
    
    document.querySelectorAll('[onclick^="showTab"]').forEach(b => {
        b.classList.remove('border-b-2', 'border-blue-600', 'text-blue-600');
        b.classList.add('border-b', 'border-gray-200', 'text-gray-600');
    });
    event.target.classList.remove('border-b', 'border-gray-200', 'text-gray-600');
    event.target.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
}

// Drag & drop + file select
const dropzone = document.getElementById('dropzone');
const csvFile = document.getElementById('csvFile');

dropzone?.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('border-blue-500', 'bg-blue-50');
});

dropzone?.addEventListener('dragleave', () => {
    dropzone.classList.remove('border-blue-500', 'bg-blue-50');
});

dropzone?.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('border-blue-500', 'bg-blue-50');
    if (e.dataTransfer.files[0]) {
        csvFile.files = e.dataTransfer.files;
        updateFileName();
    }
});

csvFile?.addEventListener('change', updateFileName);

function updateFileName() {
    const name = csvFile.files[0]?.name;
    if (name) {
        document.getElementById('file-name').textContent = `üìÑ ${name}`;
    }
}

// Copiar plantilla
document.getElementById('copy-template')?.addEventListener('click', () => {
    const code = document.getElementById('template-code').textContent;
    navigator.clipboard.writeText(code).then(() => {
        alert('‚úÖ CSV copiado. P√©galo en un archivo .csv');
    });
});

// Descargar plantilla
document.getElementById('download-template')?.addEventListener('click', (e) => {
    e.preventDefault();
    const csv = `name,description,capacity_cocktail,capacity_banquet,capacity_theater,features,address,map_iframe,external_url,images
"Sala Modernista Barcelona","Espacio di√°fano con techos altos",200,120,150,"Luz natural|Wifi|Proyector 4K","Passeig de Gr√†cia, 85, Barcelona","https://maps.google.com/?q=Barcelona","https://ejemplo.com/barcelona","/uploads/venues/barcelona-1.webp"
"Hotel Boutique Madrid","Terraza panor√°mica",150,80,100,"Vista panor√°mica|Wifi|Toldo retr√°ctil","Gran V√≠a, 32, Madrid","https://maps.google.com/?q=Madrid","https://ejemplo.com/madrid","/uploads/venues/madrid-1.webp"`;
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'venues-template.csv';
    a.click();
});

// Procesar importaci√≥n
document.getElementById('import-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData();
    formData.append('csvFile', csvFile.files[0]);
    
    try {
        const response = await fetch('/admin/venues/import', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();
        
        if (result.success) {
            showResult(`
                <div class="bg-green-50 border border-green-200 rounded p-4">
                    <h3 class="font-bold text-green-900 mb-2">‚úÖ Importaci√≥n exitosa</h3>
                    <p class="text-green-700 text-sm mb-1"><strong>${result.inserted}</strong> nuevos venues</p>
                    <p class="text-green-700 text-sm"><strong>${result.updated}</strong> actualizados</p>
                </div>
                <button type="button" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded" onclick="location.reload()">
                    Recargar p√°gina
                </button>
            `);
        } else {
            showResult(`
                <div class="bg-red-50 border border-red-200 rounded p-4">
                    <h3 class="font-bold text-red-900">‚ùå Error</h3>
                    <p class="text-red-700 text-sm">${result.error}</p>
                </div>
            `);
        }
    } catch (err) {
        showResult(`
            <div class="bg-red-50 border border-red-200 rounded p-4">
                <h3 class="font-bold text-red-900">‚ùå Error</h3>
                <p class="text-red-700 text-sm">${err.message}</p>
            </div>
        `);
    }
});

function showResult(html) {
    const resultDiv = document.getElementById('import-result');
    resultDiv.innerHTML = html;
    resultDiv.classList.remove('hidden');
}
</script>

</body>
</html>
